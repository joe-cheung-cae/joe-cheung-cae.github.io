---
import type { CollectionEntry } from 'astro:content';
import { formatDate } from '@/utils/formatDate';
import { formatReadingTime } from '@/utils/readingTime';
import TagChip from './TagChip.astro';

interface Props {
  post: CollectionEntry<'posts'>;
  featured?: boolean;
}

const { post, featured = false } = Astro.props;
const { title, description, pubDate, tags, language, readingTime } = post.data;

const baseUrl = import.meta.env.BASE_URL || '/';
const previewText = description.length > 120 ? `${description.slice(0, 117)}...` : description;
const visibleTagCount = featured ? 5 : 3;
---

<article class={`group ${featured ? 'col-span-full' : ''}`}>
  <a
    href={`${baseUrl}blog/${post.slug}`}
    class="block p-6 rounded-xl border border-notion-border dark:border-notion-border-dark bg-notion-bg dark:bg-notion-bg-dark hover:border-notion-blue dark:hover:border-notion-blue transition-all duration-200 hover:shadow-lg hover:-translate-y-0.5"
  >
    <div class="flex flex-col gap-4">
      <div class={`rounded-lg border border-notion-border dark:border-notion-border-dark px-4 py-3 ${
        featured
          ? 'bg-gradient-to-r from-notion-blue-light to-notion-gray dark:from-blue-900/20 dark:to-notion-gray-dark/70'
          : 'bg-notion-gray dark:bg-notion-gray-dark/60'
      }`}>
        <p class="text-[11px] uppercase tracking-[0.12em] text-notion-text dark:text-notion-text-dark/70 font-semibold">
          Quick Preview
        </p>
        <p class="mt-1 text-sm text-notion-text dark:text-notion-text-dark/80 line-clamp-2">
          {previewText}
        </p>
      </div>

      {/* Header */}
      <div class="flex items-start justify-between gap-4">
        <div class="flex-1 min-w-0">
          {language && (
            <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-notion-blue-light dark:bg-blue-900/30 text-notion-blue mb-2">
              {language}
            </span>
          )}
          <h3 class={`font-semibold text-notion-text dark:text-notion-text-dark group-hover:text-notion-blue transition-colors ${featured ? 'text-2xl' : 'text-lg'} line-clamp-2`}>
            {title}
          </h3>
        </div>
        {featured && (
          <span class="shrink-0 inline-flex items-center px-2 py-1 rounded-lg text-xs font-medium bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400">
            Featured
          </span>
        )}
      </div>

      {/* Description */}
      <p class={`text-notion-text dark:text-notion-text-dark/70 line-clamp-2 ${featured ? 'text-base' : 'text-sm'}`}>
        {description}
      </p>

      {/* Footer */}
      <div class="flex flex-wrap items-center gap-2 text-sm text-notion-text dark:text-notion-text-dark/60 mt-1">
        <time datetime={pubDate.toISOString()}>
          {formatDate(pubDate)}
        </time>
        {readingTime && (
          <>
            <span>·</span>
            <span>{formatReadingTime(readingTime)}</span>
          </>
        )}
        {tags.length > 0 && (
          <>
            <span>·</span>
            <span>{tags.length} topic{tags.length > 1 ? 's' : ''}</span>
          </>
        )}
      </div>

      {/* Tags */}
      {tags.length > 0 && (
        <div class="flex flex-wrap gap-2 mt-1">
          {tags.slice(0, visibleTagCount).map((tag) => (
            <TagChip tag={tag} size="sm" interactive={false} />
          ))}
          {tags.length > visibleTagCount && (
            <span class="text-xs text-notion-text dark:text-notion-text-dark/50 px-2 py-0.5">
              +{tags.length - visibleTagCount} more
            </span>
          )}
        </div>
      )}

      <span class="inline-flex items-center gap-1 text-sm font-medium text-notion-blue mt-1">
        Read note
        <span aria-hidden="true">→</span>
      </span>
    </div>
  </a>
</article>
